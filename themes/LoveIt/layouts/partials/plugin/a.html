{{- $rel := "" -}}
{{- $url := .Destination -}}
{{- $refParam := "" -}}
{{- $hasQuery := strings.Contains $url "?" -}}
{{- if $hasQuery -}}
    {{- $refParam = "&ref=" -}}
{{- else -}}
    {{- $refParam = "?ref=" -}}
{{- end -}}

{{- $refDomain := "nelson.cloud" -}}

<a href="{{ $url | safeURL }}{{ $refParam }}{{ $refDomain }}"{{ with .Title }} title="{{ . }}"{{ end }}{{ if (urls.Parse .Destination).Host | or .Newtab }}{{ $rel = "noopener" }} target="_blank"{{ end }} rel="{{ $rel }}{{ with .Rel }}{{ . }}{{ end }}"{{ with .Class }} class="{{ . }}"{{ end }}>
    {{- with .Content -}}
        {{- . | safeHTML -}}
    {{- end -}}
</a>
